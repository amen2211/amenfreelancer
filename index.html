<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Freelancer Mini Official</title>
  <style>
/* ====== CSS متقدمة للنسخة الرسمية ====== */
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  font-family:'Inter', system-ui, Arial, sans-serif;
}

body{
  background: linear-gradient(180deg, #f0f4f8, #ffffff);
  color: #0f1724;
  min-height: 100vh;
  padding: 24px;
}

.wrap{
  max-width: 1200px;
  margin: 0 auto;
}

header{
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
  padding: 12px 16px;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.brand{
  display: flex;
  gap: 12px;
  align-items: center;
}

.logo{
  width: 56px;
  height: 56px;
  border-radius: 16px;
  background: #0ea5a4;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

h1{
  font-size: 22px;
  font-weight: 600;
  color: #0f1724;
}

.sub{
  color: #475569;
  font-size: 14px;
}

.grid{
  display: grid;
  grid-template-columns: 360px 1fr;
  gap: 24px;
}

.card{
  background: #ffffff;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.06);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover{
  transform: translateY(-4px);
  box-shadow: 0 12px 28px rgba(0,0,0,0.1);
}

.card h3{
  margin-bottom: 12px;
  font-size: 18px;
  font-weight: 600;
}

label{
  display: block;
  font-size: 14px;
  margin-bottom: 6px;
  color: #334155;
  font-weight: 500;
}

input[type=text], input[type=number], select, textarea{
  width: 100%;
  padding: 12px;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  font-size: 14px;
  margin-bottom: 12px;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

input[type=text]:focus, input[type=number]:focus, select:focus, textarea:focus{
  border-color: #0ea5a4;
  box-shadow: 0 0 6px rgba(14,165,164,0.3);
  outline: none;
}

textarea{
  min-height: 100px;
  resize: vertical;
}

.row{
  display: flex;
  gap: 10px;
}

.btn{
  display: inline-block;
  padding: 12px 18px;
  border-radius: 12px;
  background: #0ea5a4;
  color: #fff;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

.btn:hover{
  background: #14b8a6;
  transform: translateY(-2px);
}

.btn.ghost{
  background: transparent;
  border: 1px solid #cbd5e1;
  color: #0f1724;
}

.controls{
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 16px;
}

.search{
  flex: 1;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid #cbd5e1;
  font-size: 14px;
}

.list{
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 16px;
}

.service{
  background: linear-gradient(180deg,#ffffff,#f9fafe);
  padding: 16px;
  border-radius: 16px;
  border: 1px solid #e6eef6;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.service:hover{
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}

.service img{
  width: 100%;
  border-radius: 12px;
  margin-bottom: 10px;
  object-fit: cover;
  height: 160px;
}

.service h4{
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 6px;
}

.meta{
  font-size: 13px;
  color: #475569;
  margin-bottom: 8px;
}

.price{
  font-weight: 700;
  color: #0f1724;
  margin-bottom: 8px;
}

.tags{
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.tag{
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  background: #eef2ff;
  color: #3730a3;
}

footer{
  margin-top: 24px;
  text-align: center;
  color: #94a3b8;
  font-size: 14px;
}

@media (max-width: 900px){
  .grid{
    grid-template-columns: 1fr;
  }
  .brand h1{
    font-size: 20px;
  }
}

</style>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">FL</div>
        <div>
          <h1>منصة خدمات رسمية</h1>
          <div class="sub">نسخة رسمية متقدمة مع Firebase</div>
        </div>
      </div>
      <div id="auth-area">
        <button id="btn-login" class="btn">تسجيل الدخول بجوجل</button>
        <button id="btn-logout" class="btn ghost" style="display:none">خروج</button>
      </div>
    </header>

    <main class="grid">
      <aside class="card">
        <h3>أضف خدمتك</h3>
        <div id="user-info" style="margin-bottom:8px;color:#334155;font-size:14px">لم تقم بتسجيل الدخول</div>
        <label>العنوان</label>
        <input id="title" type="text" placeholder="مثال: تصميم لوجو احترافي" />
        <label>التصنيف</label>
        <select id="category">
          <option value="تصميم">تصميم</option>
          <option value="برمجة">برمجة</option>
          <option value="كتابة">كتابة</option>
          <option value="تدريس">تدريس</option>
          <option value="خدمات أخرى">خدمات أخرى</option>
        </select>
        <label>السعر (د.ت)</label>
        <input id="price" type="number" placeholder="مثال: 50" />
        <label>الوصف القصير</label>
        <textarea id="desc" placeholder="صف خدمتك بإختصار..."></textarea>
        <label>وسيلة التواصل (واتساب أو بريد)</label>
        <input id="contact" type="text" placeholder="مثال: +216XXXXXXXX أو email@example.com" />
        <label>رفع صورة للخدمة</label>
        <input type="file" id="imageFile" accept="image/*" />
        <div class="row" style="margin-top:8px">
          <button id="btn-add" class="btn">نشر</button>
          <button id="btn-clear" class="btn ghost">مسح</button>
        </div>
      </aside>

      <section>
        <div class="card" style="margin-bottom:12px">
          <div class="controls">
            <input id="q" class="search" type="text" placeholder="ابحث عن خدمة أو تصنيف..." />
            <select id="filter-cat" style="width:160px">
              <option value="all">كل التصنيفات</option>
              <option>تصميم</option>
              <option>برمجة</option>
              <option>كتابة</option>
              <option>تدريس</option>
              <option>خدمات أخرى</option>
            </select>
            <button id="btn-refresh" class="btn ghost">تحديث</button>
          </div>
          <div id="list" class="list"></div>
        </div>
        <footer>
          نسخة رسمية · مصممة لتعلم كيفية الربط مع Firebase Firestore & Storage
        </footer>
      </section>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBpQ6H7CBH51giSqON3z2K_pKL25CkxfQs",
      authDomain: "freelancer-mini.firebaseapp.com",
      projectId: "freelancer-mini",
      storageBucket: "freelancer-mini.appspot.com",
      messagingSenderId: "956684834945",
      appId: "1:956684834945:web:22d9aafaa4b58b25b21580",
      measurementId: "G-EJBW8RZ58Q"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const btnLogin = document.getElementById('btn-login');
    const btnLogout = document.getElementById('btn-logout');
    const userInfo = document.getElementById('user-info');
    const btnAdd = document.getElementById('btn-add');
    const btnClear = document.getElementById('btn-clear');
    const listEl = document.getElementById('list');
    const qInput = document.getElementById('q');
    const filterCat = document.getElementById('filter-cat');
    const btnRefresh = document.getElementById('btn-refresh');
    const imageFile = document.getElementById('imageFile');

    btnLogin.addEventListener('click',()=>{ const provider=new GoogleAuthProvider(); signInWithPopup(auth,provider).catch(e=>alert(e.message));});
    btnLogout.addEventListener('click',()=>signOut(auth));

    auth.onAuthStateChanged(user=>{
      if(user){ userInfo.textContent=user.displayName+' — '+user.email; btnLogin.style.display='none'; btnLogout.style.display='inline-block';}
      else{userInfo.textContent='لم تقم بتسجيل الدخول'; btnLogin.style.display='inline-block'; btnLogout.style.display='none';}
    });

    btnClear.addEventListener('click',()=>{document.getElementById('title').value='';document.getElementById('price').value='';document.getElementById('desc').value='';document.getElementById('contact').value='';imageFile.value='';});

    async function fetchServices(){
      listEl.innerHTML='';
      const qSnap = await getDocs(query(collection(db,'services'),orderBy('timestamp','desc')));
      qSnap.forEach(doc=>{
        const data = doc.data();
        if((filterCat.value==='all'||data.category===filterCat.value)&&data.title.includes(qInput.value)){
          const div=document.createElement('div'); div.className='service';
          div.innerHTML=`<img src='${data.imgUrl||''}' alt=''><h4>${data.title}</h4><div class='meta'>${data.category} · ${data.contact}</div><div class='price'>${data.price} د.ت</div><div class='tags'>${data.desc}</div>`;
          listEl.appendChild(div);
        }
      });
    }

    btnRefresh.addEventListener('click',fetchServices);
    qInput.addEventListener('input',fetchServices);
    filterCat.addEventListener('change',fetchServices);

    btnAdd.addEventListener('click',async ()=>{
      const user = auth.currentUser;
      if(!user){alert('يجب تسجيل الدخول أولاً'); return;}
      const title=document.getElementById('title').value.trim();
      const category=document.getElementById('category').value;
      const price=Number(document.getElementById('price').value);
      const desc=document.getElementById('desc').value.trim();
      const contact=document.getElementById('contact').value.trim();
      const file=imageFile.files[0];
      if(!title||!category||!price||!desc||!contact||!file){alert('يرجى تعبئة كل الحقول ورفع صورة'); return;}
      const imgRef=ref(storage,`images/${Date.now()}_${file.name}`);
      const snap=await uploadBytes(imgRef,file);
      const url=await getDownloadURL(snap.ref);
      await addDoc(collection(db,'services'),{title,category,price,desc,contact,imgUrl:url,timestamp:serverTimestamp(),uid:user.uid});
      alert('تم نشر الخدمة');
      btnClear.click();
      fetchServices();
    });

    fetchServices();
  </script>
</body>
</html>